(()=>{"use strict";class l{draw(){return{sprite:5}}get_steps(l,t,n){let e=[],s=(l?1:-1)+n;0===l&&6===n&&null===a.board[s-1][t]&&e.push({v:s-1,h:t}),1===l&&1===n&&null===a.board[s+1][t]&&e.push({v:s+1,h:t}),null===a.board[s][t]&&e.push({v:s,h:t});for(let n of[-1,1]){let i=t+n;i<0||i>7||null!==a.board[s][i]&&a.board[s][i].color!==l&&e.push({v:s,h:i})}return e}}class t{draw(){return{sprite:3}}get_steps(l,t,n){let e=[],s=[{h:2,v:1,a:!0},{h:2,v:-1,a:!0},{h:-2,v:1,a:!0},{h:-2,v:-1,a:!0},{h:1,v:2,a:!0},{h:1,v:-2,a:!0},{h:-1,v:2,a:!0},{h:-1,v:-2,a:!0}];for(let i=1;i<2;i++)for(let o=0;o<8;o++){let u=s[o];if(u.a){let s=t+u.h*i,o=n+u.v*i;if(s>7||s<0)continue;if(o>7||o<0)continue;if(null===a.board[o][s])e.push({v:o,h:s});else{if(void 0===a.board[o][s])continue;a.board[o][s].color!==l&&e.push({v:o,h:s}),u.a=!1}}}return e}}class n{draw(){return{sprite:0}}get_steps(l,t,n){let e=[],s=[{h:1,v:1,a:!0},{h:-1,v:-1,a:!0},{h:1,v:-1,a:!0},{h:-1,v:1,a:!0},{h:1,v:0,a:!0},{h:-1,v:0,a:!0},{h:0,v:1,a:!0},{h:0,v:-1,a:!0}];for(let i=1;i<2;i++)for(let o=0;o<8;o++){let u=s[o];if(u.a){let s=t+u.h*i,o=n+u.v*i;if(s>7||s<0)continue;if(o>7||o<0)continue;if(null===a.board[o][s])e.push({v:o,h:s});else{if(void 0===a.board[o][s])continue;a.board[o][s].color!==l&&e.push({v:o,h:s}),u.a=!1}}}return e}}class e{draw(){return{sprite:1}}get_steps(l,t,n){let e=[],s=[{h:1,v:1,a:!0},{h:-1,v:-1,a:!0},{h:1,v:-1,a:!0},{h:-1,v:1,a:!0},{h:1,v:0,a:!0},{h:-1,v:0,a:!0},{h:0,v:1,a:!0},{h:0,v:-1,a:!0}];for(let i=1;i<8;i++)for(let o=0;o<8;o++){let u=s[o];if(u.a){let s=t+u.h*i,o=n+u.v*i;if(s>7||s<0)continue;if(o>7||o<0)continue;if(null===a.board[o][s])e.push({v:o,h:s});else{if(void 0===a.board[o][s])continue;a.board[o][s].color!==l&&e.push({v:o,h:s}),u.a=!1}}}return e}}class s{draw(){return{sprite:2}}get_steps(l,t,n){let e=[],s=[{h:1,v:1,a:!0},{h:-1,v:-1,a:!0},{h:1,v:-1,a:!0},{h:-1,v:1,a:!0}];for(let i=1;i<8;i++)for(let o=0;o<4;o++){let u=s[o];if(u.a){let s=t+u.h*i,o=n+u.v*i;if(s>7||s<0)continue;if(o>7||o<0)continue;if(null===a.board[o][s])e.push({v:o,h:s});else{if(void 0===a.board[o][s])continue;a.board[o][s].color!==l&&e.push({v:o,h:s}),u.a=!1}}}return e}}class i{draw(){return{sprite:4}}get_steps(l,t,n){let e=[],s=[{h:1,v:0,a:!0},{h:-1,v:0,a:!0},{h:0,v:-1,a:!0},{h:0,v:1,a:!0}];for(let i=1;i<8;i++)for(let o=0;o<4;o++){let u=s[o];if(u.a){let s=t+u.h*i,o=n+u.v*i;if(s>7||s<0)continue;if(o>7||o<0)continue;if(null===a.board[o][s])e.push({v:o,h:s});else{if(void 0===a.board[o][s])continue;a.board[o][s].color!==l&&e.push({v:o,h:s}),u.a=!1}}}return e}}const o={sprites:{chessmen:null},start(){this.sprites.chessmen=new Image,this.sprites.chessmen.src="sprites.png"}};class u{color=0;v=0;h=0;piece=null;active=!1;constructor(o,u,a,h){switch(this.h=u,this.v=a,this.color=h,o){case"pawn":this.piece=new l;break;case"knight":this.piece=new t;break;case"king":this.piece=new n;break;case"queen":this.piece=new e;break;case"bishop":this.piece=new s;break;case"rook":this.piece=new i;break;default:console.error("Didn't find piece")}}draw(){let l=this.piece.draw();this.active?(a.ctx.fillStyle="#9cce9d",a.ctx.fillRect(this.h*a.block,this.v*a.block,a.block,a.block),a.ctx.drawImage(o.sprites.chessmen,213*l.sprite,213*this.color,213,213,a.cursor.x+a.cursor.ox,a.cursor.y+a.cursor.oy,a.block,a.block)):a.ctx.drawImage(o.sprites.chessmen,213*l.sprite,213*this.color,213,213,this.h*a.block,this.v*a.block,a.block,a.block)}set_active(){this.active=!0}set_disactive(){this.active=!1}get_steps(){return this.piece.get_steps(this.color,this.h,this.v)}draw_tips(){let l=this.get_steps(this.color,this.h,this.v);for(let t=0;t<l.length;t++)a.ctx.fillStyle="#9cc0ce",a.ctx.globalAlpha=.7,a.ctx.fillRect(l[t].h*a.block,l[t].v*a.block,a.block,a.block),a.ctx.globalAlpha=1}go(t,n){a.board[this.v][this.h]=null,this.h=t,this.v=n,a.board[n][t]=this,this.piece instanceof l&&(0!==this.v&&7!==this.v||(this.piece=new e))}move(l,t){}}const a={block:50,canvas:null,ctx:null,active:null,cursor:{x:0,y:0,ox:0,oy:0},board:[[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null]],start_positions:[[["rook",1],["knight",1],["bishop",1],["queen",1],["king",1],["bishop",1],["knight",1],["rook",1]],[["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1]],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0]],[["rook",0],["knight",0],["bishop",0],["queen",0],["king",0],["bishop",0],["knight",0],["rook",0]]],start:function(){o.start(),this.canvas=document.getElementById("board"),this.ctx=this.canvas.getContext("2d");for(let l=0;l<8;l++)for(let t=0;t<8;t++)null!==this.start_positions[l][t]&&(this.board[l][t]=new u(this.start_positions[l][t][0],t,l,this.start_positions[l][t][1]))},draw:function(){this.draw_board(),this.draw_tips(),this.draw_chessmen()},draw_board:function(){this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(0,0,8*this.block,8*this.block);let l=0;for(let t=0;t<8;t++){for(let n=0;n<8;n++)this.ctx.fillStyle=l%2==-0?"#ceb29c":"#f5e6cf",this.ctx.fillRect(n*this.block,t*this.block,this.block,this.block),l++;l++}},draw_chessmen:function(){for(let l=0;l<8;l++)for(let t=0;t<8;t++)null!==this.board[l][t]&&this.board[l][t].draw()},draw_tips:function(){null!==this.active&&this.board[this.active.v][this.active.h].draw_tips()},down:function(l,t){null!==this.board[t][l]&&(this.board[t][l].set_active(),this.active={v:t,h:l})},up:function(l,t){let n=!1;if(this.active){if(null!==this.board[this.active.v][this.active.h]){let e=this.board[this.active.v][this.active.h].get_steps();for(let s of e)s.h===l&&s.v===t&&(this.board[this.active.v][this.active.h].go(l,t),this.active={v:t,h:l},n=!0)}this.board[this.active.v][this.active.h].set_disactive(),this.active=null}},tic:function(){this.draw()}};a.start(),a.canvas.addEventListener("mousedown",(function(l){let t=Math.floor(l.offsetX/a.block),n=Math.floor(l.offsetY/a.block);a.cursor.ox=t*a.block-l.offsetX,a.cursor.oy=n*a.block-l.offsetY,a.down(t,n)})),a.canvas.addEventListener("mouseup",(function(l){let t=Math.floor(l.offsetX/a.block),n=Math.floor(l.offsetY/a.block);a.up(t,n)})),a.canvas.addEventListener("mousemove",(function(l){a.cursor.x=l.offsetX,a.cursor.y=l.offsetY})),function l(){a.tic(),setTimeout(l,1e3/30)}()})();