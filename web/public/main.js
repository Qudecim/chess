(()=>{"use strict";class l{draw(){return{}}get_steps(l,t,n){let i=[],s=(l?1:-1)+n;null===a.board[s][t]&&i.push({v:s,h:t});for(let n of[-1,1]){let e=t+n;e<0||e>7||null!==a.board[s][e]&&a.board[s][e].color!==l&&i.push({v:s,h:e})}return i}}class t{draw(){return{}}}class n{draw(){return{}}}class i{draw(){return{}}get_steps(){return[{v:3,h:3}]}}class s{draw(){return{}}}class e{draw(){return{}}}class u{color=0;v=0;h=0;piece=null;active=!1;constructor(u,a,c,h){switch(this.h=a,this.v=c,this.color=h,u){case"pawn":this.piece=new l;break;case"knight":this.piece=new t;break;case"king":this.piece=new n;break;case"queen":this.piece=new i;break;case"bishop":this.piece=new s;break;case"rook":this.piece=new e;break;default:console.error("Didn't find piece")}}draw(){this.piece.draw(),a.ctx.fillStyle="rgb(88,255,0)",this.active&&(a.ctx.fillStyle="rgb(255,255,0)"),a.ctx.fillRect(this.h*a.block,this.v*a.block,a.block,a.block)}set_active(){this.active=!0}set_disactive(){this.active=!1}get_steps(){return this.piece.get_steps(this.color,this.h,this.v)}draw_tips(){let l=this.get_steps(this.color,this.h,this.v);for(let t=0;t<l.length;t++)a.ctx.fillStyle="rgb(0,255,255)",a.ctx.fillRect(l[t].h*a.block,l[t].v*a.block,a.block,a.block)}go(t,n){a.board[this.v][this.h]=null,this.h=t,this.v=n,a.board[n][t]=this,this.piece instanceof l&&(0!==this.v&&7!==this.v||(this.piece=new i))}move(l,t){}}const a={block:50,canvas:null,ctx:null,active:null,board:[[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null]],start_positions:[[["rook",1],["knight",1],["bishop",1],["queen",1],["king",1],["bishop",1],["knight",1],["rook",1]],[["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1],["pawn",1]],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null],[["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0],["pawn",0]],[["rook",0],["knight",0],["bishop",0],["queen",0],["king",0],["bishop",0],["knight",0],["rook",0]]],start:function(){this.canvas=document.getElementById("board"),this.ctx=this.canvas.getContext("2d");for(let l=0;l<8;l++)for(let t=0;t<8;t++)null!==this.start_positions[l][t]&&(this.board[l][t]=new u(this.start_positions[l][t][0],t,l,this.start_positions[l][t][1]))},draw:function(){this.draw_board(),this.draw_chessmen(),this.draw_tips()},draw_board:function(){this.ctx.fillStyle="rgb(255, 255, 255)",this.ctx.fillRect(0,0,8*this.block,8*this.block),this.ctx.fillStyle="rgb(0, 0, 0)";let l=0;for(let t=0;t<8;t++){for(let n=0;n<8;n++)l%2==-0&&this.ctx.fillRect(n*this.block,t*this.block,this.block,this.block),l++;l++}},draw_chessmen:function(){for(let l=0;l<8;l++)for(let t=0;t<8;t++)null!==this.board[l][t]&&this.board[l][t].draw()},draw_tips:function(){null!==this.active&&this.board[this.active.v][this.active.h].draw_tips()},set_active:function(l,t){if(null===this.active)this.board[t][l].set_active(),this.active={v:t,h:l};else{let n=!1;if(console.log(this.active.v,this.active.h),null!==this.board[this.active.v][this.active.h]){let i=this.board[this.active.v][this.active.h].get_steps();for(let s of i)s.h===l&&s.v===t&&(this.board[this.active.v][this.active.h].go(l,t),this.active={v:t,h:l},n=!0)}n||(this.board[this.active.v][this.active.h].set_disactive(),this.active=null)}},tic:function(){this.draw()}};a.start(),a.canvas.addEventListener("click",(function(l){let t=Math.floor(l.offsetX/a.block),n=Math.floor(l.offsetY/a.block);a.set_active(t,n)})),function l(){a.tic(),setTimeout(l,100)}()})();